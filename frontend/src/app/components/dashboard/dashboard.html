<div class="dashboard-container">
  <!-- Loading state -->
  <div *ngIf="loading" class="loading-container">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <p>Loading dashboard...</p>
  </div>

  <!-- Dashboard content -->
  <div *ngIf="!loading" class="dashboard-content">
    <!-- Header with user info and sync button -->
    <div class="dashboard-header">
      <div class="user-info">
        <h1>Welcome back, {{ currentUser?.username }}!</h1>
        <p class="subtitle">Here's your gamification dashboard</p>
      </div>
      <button mat-raised-button color="primary" (click)="syncActivities()" [disabled]="syncing">
        <mat-icon>sync</mat-icon>
        {{ syncing ? 'Syncing...' : 'Sync Activities' }}
      </button>
    </div>

    <!-- Stats overview -->
    <div class="stats-grid" *ngIf="userStats">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <mat-icon class="stat-icon">stars</mat-icon>
            <div class="stat-info">
              <h2>{{ userStats.total_points }}</h2>
              <p>Total Points</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <mat-icon class="stat-icon">military_tech</mat-icon>
            <div class="stat-info">
              <h2>{{ userStats.badges_earned }}</h2>
              <p>Badges Earned</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <mat-icon class="stat-icon">timeline</mat-icon>
            <div class="stat-info">
              <h2>{{ userStats.activity_breakdown.length }}</h2>
              <p>Activity Types</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Main content grid -->
    <div class="content-grid">
      <!-- Recent Activities -->
      <mat-card class="activities-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>history</mat-icon>
            Recent Activities
          </mat-card-title>
          <mat-card-subtitle>Your latest contributions</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="recentActivities.length === 0" class="empty-state">
            <mat-icon>info</mat-icon>
            <p>No recent activities. Sync your activities to see them here!</p>
          </div>
          <div *ngFor="let activity of recentActivities" class="activity-item">
            <mat-icon class="activity-icon">{{ getActivityIcon(activity.activity_type) }}</mat-icon>
            <div class="activity-details">
              <h4>{{ getActivityTypeLabel(activity.activity_type) }}</h4>
              <p class="activity-meta">
                {{ activity.points_earned }} points â€¢ 
                {{ activity.activity_date | date:'short' }}
              </p>
            </div>
            <div class="activity-points">
              +{{ activity.points_earned }}
            </div>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <a mat-button routerLink="/activities">View All Activities</a>
        </mat-card-actions>
      </mat-card>

      <!-- Activity Breakdown -->
      <mat-card class="breakdown-card" *ngIf="userStats">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>pie_chart</mat-icon>
            Activity Breakdown
          </mat-card-title>
          <mat-card-subtitle>Points by activity type</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div *ngFor="let breakdown of userStats.activity_breakdown" class="breakdown-item">
            <div class="breakdown-header">
              <span class="breakdown-type">{{ getActivityTypeLabel(breakdown.activity_type) }}</span>
              <span class="breakdown-points">{{ breakdown.points }} pts</span>
            </div>
            <div class="breakdown-meta">
              <span class="breakdown-count">{{ breakdown.count }} activities</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Badge Progress -->
      <mat-card class="badges-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>emoji_events</mat-icon>
            Badge Progress
          </mat-card-title>
          <mat-card-subtitle>Your next achievements</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="badgeProgress.length === 0" class="empty-state">
            <mat-icon>info</mat-icon>
            <p>No badge progress available. Complete more activities to unlock badges!</p>
          </div>
          <div *ngFor="let badge of badgeProgress" class="badge-progress-item">
            <div class="badge-info">
              <mat-icon class="badge-icon">{{ getBadgeIcon(badge.category) }}</mat-icon>
              <div class="badge-details">
                <h4>{{ badge.name }}</h4>
                <p class="badge-description">{{ badge.description }}</p>
                <div class="progress-info">
                  <span>{{ badge.current || 0 }}/{{ badge.target }} - {{ badge.points }} points</span>
                </div>
              </div>
            </div>
            <div class="progress-container">
              <mat-progress-bar 
                mode="determinate" 
                [value]="getProgressPercentage(badge.current || 0, badge.target || 1)"
                color="primary">
              </mat-progress-bar>
            </div>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <a mat-button routerLink="/badges">View All Badges</a>
        </mat-card-actions>
      </mat-card>

      <!-- Streaks -->
      <mat-card class="streaks-card" *ngIf="userStats && userStats.streaks.length > 0">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>local_fire_department</mat-icon>
            Your Streaks
          </mat-card-title>
          <mat-card-subtitle>Keep up the momentum!</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div *ngFor="let streak of userStats.streaks" class="streak-item">
            <div class="streak-info">
              <h4>{{ streak.streak_type.replace('_', ' ') | titlecase }}</h4>
              <div class="streak-values">
                <span class="current-streak">Current: {{ streak.current_streak }}</span>
                <span class="longest-streak">Best: {{ streak.longest_streak }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
